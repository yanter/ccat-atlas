{"version":3,"sources":["../src/helpers/animations.ts","../src/helpers/constants.ts","../src/helpers/easing.ts","../src/helpers/attributes.ts","../src/helpers/position-calculator.ts","../src/helpers/elements.ts","../src/helpers/keyframes.ts","../src/helpers/observer.ts","../src/helpers/utils.ts","../src/helpers/scroll-handler.ts","../src/index.ts"],"sourcesContent":["// ===================================================================\n// ANIMATION CONTROL SYSTEM\n// ===================================================================\n// This module manages animation creation, playback, and state for\n// Motion-on-Scroll elements. It handles both built-in animations\n// and custom user-registered animations.\n\nimport { animate, type AnimationPlaybackControls, type KeyframeOptions } from \"motion\";\n\nimport { DEFAULT_OPTIONS } from \"./constants.js\";\nimport { resolveEasing } from \"./easing.js\";\nimport { findPreparedElement } from \"./elements.js\";\nimport { getKeyframesWithDistance, resolveKeyframes } from \"./keyframes.js\";\nimport type { ElementOptions, MosElement } from \"./types.js\";\n\n// ===================================================================\n// TYPES AND INTERFACES\n// ===================================================================\n\n/**\n * Factory function type for creating custom animations\n * Takes an element and options, returns Motion's animation controls\n */\nexport type AnimationFactory = (el: HTMLElement, opts: ElementOptions) => AnimationPlaybackControls;\n\n// ===================================================================\n// MODULE STATE\n// ===================================================================\n\n/**\n * Maps elements to their currently running animation controls\n * Used to track which elements are actively animating\n */\nconst activeAnimations = new WeakMap<HTMLElement, AnimationPlaybackControls>();\n\n/**\n * Registry of custom animations registered by users\n * Maps animation names to their factory functions\n */\nconst customAnimationRegistry: Record<string, AnimationFactory> = {};\n\n// ===================================================================\n// CUSTOM ANIMATION REGISTRATION\n// ===================================================================\n\n/**\n * Registers a custom animation that can be used by name in data-mos attributes\n * The factory function receives the element and options, and must return Motion's AnimationPlaybackControls\n *\n * @param name - Unique name for the animation (used in data-mos=\"name\")\n * @param factory - Function that creates and returns animation controls\n *\n * @example\n * ```typescript\n * registerAnimation('customSlide', (element, options) => {\n *   return animate(element, { x: [100, 0] }, { duration: options.duration });\n * });\n * ```\n *\n * @throws Error if name is empty or invalid\n */\nexport function registerAnimation(name: string, factory: AnimationFactory): void {\n  if (!name || name.trim() === \"\") {\n    throw new Error(\"Custom animation name must be non-empty\");\n  }\n  customAnimationRegistry[name] = factory;\n}\n\n// ===================================================================\n// ANIMATION CONTROL MANAGEMENT\n// ===================================================================\n\n/**\n * Ensures animation controls exist for an element, creating them only once\n * Subsequent calls return the existing controls for performance\n *\n * @param element - The DOM element to ensure animation for\n * @param options - Animation configuration options\n * @returns Animation controls or null if creation failed\n */\nfunction ensureAnimationControls(\n  element: HTMLElement,\n  options: ElementOptions,\n): AnimationPlaybackControls | null {\n  const mosElement = findPreparedElement(element);\n  if (!mosElement) return null;\n\n  // Return existing controls if available\n  if (mosElement.controls) {\n    return mosElement.controls;\n  }\n\n  // Create new animation controls\n  const controls = createAnimationControls(element, options);\n  if (!controls) return null;\n\n  // Store controls in unified element\n  mosElement.controls = controls;\n\n  return controls;\n}\n\n// ===================================================================\n// ANIMATION STATE SETTERS\n// ===================================================================\n\n/**\n * Sets an element to its initial animation state without playing the animation\n * Creates animation controls but preserves natural position for accurate scroll calculations\n * CSS handles initial visibility (opacity: 0, visibility: hidden, etc.)\n *\n * @param mosElement - The MOS element data containing element, options, and state\n */\nexport function setInitialState(mosElement: MosElement): void {\n  const { element, options } = mosElement;\n\n  // Skip if element is currently animating\n  if (activeAnimations.has(element)) return;\n\n  const controls = ensureAnimationControls(element, options);\n  if (!controls) return;\n\n  // Pause controls without setting time to preserve natural element position\n  // This is crucial for accurate scroll position calculations\n  controls.pause();\n\n  // Update element state\n  mosElement.animated = false;\n  mosElement.isReversing = false;\n}\n\n/**\n * Sets up a single completion handler for animation controls\n * Uses element state to determine whether to handle forward or reverse completion\n *\n * @param element - The DOM element being animated\n * @param controls - The animation controls to set up handler for\n * @param options - Animation configuration options\n */\nfunction setupAnimationCompletionHandler(\n  element: HTMLElement,\n  controls: AnimationPlaybackControls,\n  options: ElementOptions,\n): void {\n  controls.finished\n    .then(() => {\n      const mosElement = findPreparedElement(element);\n      if (!mosElement) return;\n\n      if (mosElement.isReversing) {\n        handleReverseAnimationCompletion(element, controls, mosElement);\n      } else {\n        handleForwardAnimationCompletion(element, controls, options);\n      }\n    })\n    .catch(() => {\n      handleAnimationInterruption(element);\n    });\n}\n\n/**\n * Handles completion of a reverse animation\n * Resets element to initial state and calls completion callback\n */\nfunction handleReverseAnimationCompletion(\n  element: HTMLElement,\n  controls: AnimationPlaybackControls,\n  mosElement: MosElement,\n): void {\n  // Reset animation to initial state\n  controls.time = 0;\n  controls.pause();\n  activeAnimations.delete(element);\n  element.classList.remove(\"mos-animate\");\n\n  // Update state\n  mosElement.isReversing = false;\n  mosElement.animated = false;\n}\n\n/**\n * Handles completion of a forward animation\n * Cleans up active animation tracking\n */\nfunction handleForwardAnimationCompletion(\n  element: HTMLElement,\n  controls: AnimationPlaybackControls,\n  options: ElementOptions,\n): void {\n  if (options.once) {\n    // Stop animation permanently for once-only animations\n    controls.stop();\n  }\n\n  // Remove from active animations\n  activeAnimations.delete(element);\n}\n\n/**\n * Handles animation interruption (cancellation, errors, etc.)\n * Cleans up state to prevent memory leaks\n */\nfunction handleAnimationInterruption(element: HTMLElement): void {\n  const mosElement = findPreparedElement(element);\n  if (mosElement) {\n    mosElement.isReversing = false;\n  }\n}\n\n// ===================================================================\n// ANIMATION CREATION\n// ===================================================================\n\n/**\n * Creates animation controls for an element without starting playback\n * Handles both custom animations and built-in keyframe animations\n *\n * @param element - The DOM element to create animation for\n * @param options - Animation configuration options\n * @returns Animation controls or null if creation failed\n */\nfunction createAnimationControls(\n  element: HTMLElement,\n  options: ElementOptions,\n): AnimationPlaybackControls | null {\n  // Check for custom animation first\n  const customAnimation = customAnimationRegistry[options.keyframes];\n  if (customAnimation) {\n    return createCustomAnimation(element, options, customAnimation);\n  }\n\n  // Create built-in keyframe animation\n  return createKeyframeAnimation(element, options);\n}\n\n/**\n * Creates a custom animation using a registered animation factory\n * @param element - The DOM element to animate\n * @param options - Animation configuration options\n * @param factory - The custom animation factory function\n * @returns Animation controls from the custom factory\n */\nfunction createCustomAnimation(\n  element: HTMLElement,\n  options: ElementOptions,\n  factory: AnimationFactory,\n): AnimationPlaybackControls {\n  const controls = factory(element, options);\n  setupAnimationCompletionHandler(element, controls, options);\n  return controls;\n}\n\n/**\n * Creates a built-in keyframe animation using Motion's animate function\n * @param element - The DOM element to animate\n * @param options - Animation configuration options\n * @returns Animation controls from Motion\n */\nfunction createKeyframeAnimation(\n  element: HTMLElement,\n  options: ElementOptions,\n): AnimationPlaybackControls {\n  // Resolve keyframes for the animation\n  const keyframes = resolveAnimationKeyframes(options);\n\n  // Resolve easing function\n  const easing = resolveAnimationEasing(options);\n\n  // Create animation with Motion\n  const controls = animate(element, keyframes, {\n    duration: options.timeUnits === \"s\" ? options.duration : options.duration / 1000,\n    delay: options.timeUnits === \"s\" ? options.delay : options.delay / 1000,\n    ease: easing,\n    fill: \"both\",\n  } as KeyframeOptions);\n\n  // Set up completion handling\n  setupAnimationCompletionHandler(element, controls, options);\n\n  return controls;\n}\n\n/**\n * Resolves and processes keyframes for an animation\n * Applies custom distance if specified\n * @param options - Animation configuration options\n * @returns Processed keyframes ready for Motion\n */\nfunction resolveAnimationKeyframes(options: ElementOptions): any {\n  const resolvedKeyframes = resolveKeyframes(options.keyframes);\n\n  // Apply custom distance if different from default\n  if (options.distance != null && options.distance !== DEFAULT_OPTIONS.distance) {\n    return getKeyframesWithDistance(options, resolvedKeyframes);\n  }\n\n  return resolvedKeyframes;\n}\n\n/**\n * Resolves the easing function for an animation\n * Handles fallback to default easing if invalid\n * @param options - Animation configuration options\n * @returns Resolved easing function or undefined\n */\nfunction resolveAnimationEasing(options: ElementOptions): any {\n  let easing = resolveEasing(options.easing);\n\n  // Handle invalid easing with fallback\n  if (options.easing && easing === null) {\n    console.warn(\n      `[MOS] Invalid easing \"${String(options.easing)}\" – falling back to default \"${DEFAULT_OPTIONS.easing}\".`,\n    );\n    easing = resolveEasing(DEFAULT_OPTIONS.easing);\n  }\n\n  return easing === null ? undefined : easing;\n}\n\n/**\n * Sets an element to its final animation state instantly\n * Used for elements that are above the viewport on page load\n * Uses Motion's complete() method to properly set final state for smooth reversal\n *\n * @param mosElement - The MOS element data containing element, options, and state\n */\nexport function setFinalState(mosElement: MosElement): void {\n  const { element, options } = mosElement;\n\n  const controls = ensureAnimationControls(element, options);\n  if (!controls) return;\n\n  // Use Motion's complete() method to properly reach final state\n  // This ensures the animation is in the correct state for smooth reversal\n  controls.complete();\n\n  // Mark element as animated and add CSS class\n  element.classList.add(\"mos-animate\");\n\n  // Update element state\n  mosElement.animated = true;\n  mosElement.isReversing = false;\n}\n\n// ===================================================================\n// ANIMATION PLAYBACK CONTROL\n// ===================================================================\n\n/**\n * Plays the animation for an element in the forward direction\n * Creates animation controls if they don't exist, otherwise reuses existing ones\n *\n * @param mosElement - The MOS element data containing element, options, and state\n */\nexport function play(mosElement: MosElement): void {\n  const { element, options } = mosElement;\n\n  // Ensure animation controls exist\n  const controls = ensureAnimationControls(element, options);\n  if (!controls) return;\n\n  const existingAnimation = activeAnimations.get(element);\n\n  // Don't interrupt if already animating forward\n  if (existingAnimation && !mosElement.isReversing) return;\n\n  // Configure for forward playback\n  controls.speed = 1;\n  controls.play();\n\n  // Update state\n  mosElement.animated = true;\n  mosElement.isReversing = false;\n\n  // Add CSS class for styling and mark as actively animating\n  element.classList.add(\"mos-animate\");\n  activeAnimations.set(element, controls);\n}\n\n/**\n * Reverses the animation for an element (used for scroll up behavior)\n * Uses negative playback speed to smoothly reverse the animation\n *\n * @param mosElement - The MOS element data containing element, options, and state\n */\nexport function reverse(mosElement: MosElement): void {\n  if (!mosElement.controls) return;\n\n  const { element, controls } = mosElement;\n\n  // Configure for reverse playback\n  mosElement.isReversing = true;\n  controls.speed = -1;\n  controls.play();\n\n  // Mark as actively animating\n  activeAnimations.set(element, controls);\n}\n\nexport default {\n  play,\n  reverse,\n  setFinalState,\n  setInitialState,\n  registerAnimation,\n};\n","import type { DOMKeyframesDefinition, KeyframeOptions } from \"motion\";\n\nimport type { MosOptions } from \"./types.js\";\nexport const DATA_PREFIX = \"mos\";\n\n/**\n * Default options for MOS, based on AOS defaults\n */\nexport const DEFAULT_OPTIONS: MosOptions = {\n  offset: 120,\n  duration: 400,\n  distance: 100,\n  delay: 0,\n  easing: \"ease\",\n  once: false,\n  mirror: false,\n  disable: false,\n  disableMutationObserver: false,\n  timeUnits: \"ms\",\n  startEvent: \"DOMContentLoaded\",\n  throttleDelay: 99,\n  debounceDelay: 50,\n};\n\n/**\n * Common easing keywords mapped to their cubic-bezier equivalents (ported from AOS),\n * in addition to the standard supported functions from motion\n */\nexport const EASINGS: Record<string, KeyframeOptions[\"ease\"]> = {\n  linear: \"linear\",\n  ease: undefined, // this is how motion represents \"ease\"\n  \"ease-in\": \"easeIn\",\n  \"ease-out\": \"easeOut\",\n  \"ease-in-out\": \"easeInOut\",\n  \"circ-in\": \"circIn\",\n  \"circ-out\": \"circOut\",\n  \"circ-in-out\": \"circInOut\",\n  \"back-in\": \"backIn\",\n  \"back-out\": \"backOut\",\n  \"back-in-out\": \"backInOut\",\n  anticipate: \"anticipate\",\n\n  \"ease-in-back\": [0.6, -0.28, 0.735, 0.045],\n  \"ease-out-back\": [0.175, 0.885, 0.32, 1.275],\n  \"ease-in-out-back\": [0.68, -0.55, 0.265, 1.55],\n\n  \"ease-in-sine\": [0.47, 0, 0.745, 0.715],\n  \"ease-out-sine\": [0.39, 0.575, 0.565, 1],\n  \"ease-in-out-sine\": [0.445, 0.05, 0.55, 0.95],\n\n  \"ease-in-quad\": [0.55, 0.085, 0.68, 0.53],\n  \"ease-out-quad\": [0.25, 0.46, 0.45, 0.94],\n  \"ease-in-out-quad\": [0.455, 0.03, 0.515, 0.955],\n\n  \"ease-in-cubic\": [0.55, 0.085, 0.68, 0.53],\n  \"ease-out-cubic\": [0.25, 0.46, 0.45, 0.94],\n  \"ease-in-out-cubic\": [0.455, 0.03, 0.515, 0.955],\n\n  \"ease-in-quart\": [0.55, 0.085, 0.68, 0.53],\n  \"ease-out-quart\": [0.25, 0.46, 0.45, 0.94],\n  \"ease-in-out-quart\": [0.455, 0.03, 0.515, 0.955],\n} as const;\nexport type EasingKeyword = keyof typeof EASINGS;\n\n// Built-in animation presets\nexport const KEYFRAMES_PRESETS: Record<string, DOMKeyframesDefinition> = {\n  // Fades\n  fade: { opacity: [0, 1] },\n  \"fade-up\": { opacity: [0, 1], translateY: [100, 0] },\n  \"fade-down\": { opacity: [0, 1], translateY: [-100, 0] },\n  \"fade-left\": { opacity: [0, 1], translateX: [100, 0] },\n  \"fade-right\": { opacity: [0, 1], translateX: [-100, 0] },\n  \"fade-up-right\": { opacity: [0, 1], translateY: [100, 0], translateX: [-100, 0] },\n  \"fade-up-left\": { opacity: [0, 1], translateY: [100, 0], translateX: [100, 0] },\n  \"fade-down-right\": { opacity: [0, 1], translateY: [-100, 0], translateX: [-100, 0] },\n  \"fade-down-left\": { opacity: [0, 1], translateY: [-100, 0], translateX: [100, 0] },\n  // Flips\n  \"flip-up\": { perspective: [2500, 2500], rotateX: [-100, 0] },\n  \"flip-down\": { perspective: [2500, 2500], rotateX: [100, 0] },\n  \"flip-left\": { perspective: [2500, 2500], rotateY: [100, 0] },\n  \"flip-right\": { perspective: [2500, 2500], rotateY: [-100, 0] },\n  // Slides\n  \"slide-up\": { translateY: [100, 0] },\n  \"slide-down\": { translateY: [-100, 0] },\n  \"slide-left\": { translateX: [100, 0] },\n  \"slide-right\": { translateX: [-100, 0] },\n  // Zooms\n  \"zoom-in\": { opacity: [0, 1], scale: [0.6, 1] },\n  \"zoom-in-up\": { opacity: [0, 1], scale: [0.6, 1], translateY: [100, 0] },\n  \"zoom-in-down\": { opacity: [0, 1], scale: [0.6, 1], translateY: [-100, 0] },\n  \"zoom-in-left\": { opacity: [0, 1], scale: [0.6, 1], translateX: [100, 0] },\n  \"zoom-in-right\": { opacity: [0, 1], scale: [0.6, 1], translateX: [-100, 0] },\n  \"zoom-out\": { opacity: [0, 1], scale: [1.2, 1] },\n  \"zoom-out-up\": { opacity: [0, 1], scale: [1.2, 1], translateY: [100, 0] },\n  \"zoom-out-down\": { opacity: [0, 1], scale: [1.2, 1], translateY: [-100, 0] },\n  \"zoom-out-left\": { opacity: [0, 1], scale: [1.2, 1], translateX: [100, 0] },\n  \"zoom-out-right\": { opacity: [0, 1], scale: [1.2, 1], translateX: [-100, 0] },\n};\n","import { type KeyframeOptions } from \"motion\";\n\nimport { EASINGS } from \"./constants.js\";\n\n/**\n * Type for custom easing definitions that can be registered\n */\nexport type EasingDefinition = KeyframeOptions[\"ease\"];\n\n/**\n * Storage for custom registered easings\n */\nconst customEasings: Record<string, EasingDefinition> = {};\n\n/**\n * Resolve a developer-supplied easing value into something Motion accepts.\n *\n * Accepts the following forms (mirrors MOS runtime):\n * 1. Custom easing name (registered via `registerEasing`) → cubic-bezier array\n * 2. Keyword (in EASINGS map)             → mapped cubic-bezier string\n * 3. `cubic-bezier(x1, y1, x2, y2)`       → number[4]\n * 4. `[x1,y1,x2,y2]` or `x1,y1,x2,y2`     → number[4]\n * 5. Otherwise                            → null\n */\nexport function resolveEasing(input: unknown): EasingDefinition | null {\n  if (input == null || typeof input !== \"string\") return undefined;\n\n  // 1. Keyword mapping (check custom easings first, then built-in)\n  if (Object.prototype.hasOwnProperty.call(customEasings, input)) return customEasings[input];\n\n  if (Object.prototype.hasOwnProperty.call(EASINGS, input))\n    return EASINGS[input as keyof typeof EASINGS];\n\n  const candidate = input.trim();\n\n  // 2. cubic-bezier() string → array\n  const cubicMatch = candidate.match(\n    /cubic-bezier\\s*\\(\\s*([0-9.]+)\\s*,\\s*([0-9.]+)\\s*,\\s*([0-9.]+)\\s*,\\s*([0-9.]+)\\s*\\)/,\n  );\n  if (cubicMatch) {\n    const nums = cubicMatch.slice(1, 5).map(Number);\n    if (nums.length === 4 && nums.every((n) => Number.isFinite(n))) {\n      return nums as [number, number, number, number];\n    }\n  }\n\n  // 3. Bare/Bracketed array\n  const arrayMatch = candidate.match(\n    /^[\\s[]*([0-9.]+)\\s*,\\s*([0-9.]+)\\s*,\\s*([0-9.]+)\\s*,\\s*([0-9.]+)[\\s\\]]*$/,\n  );\n  if (arrayMatch) {\n    const nums = arrayMatch.slice(1, 5).map(Number);\n    if (nums.length === 4 && nums.every((n) => Number.isFinite(n))) {\n      return nums as [number, number, number, number];\n    }\n  }\n\n  // 4. Invalid → null (signals caller to fallback)\n  return null;\n}\n\n/**\n * Register a custom easing function with a given name.\n *\n * Accepts Motion's easing definitions:\n * - Named strings: \"easeIn\", \"easeOut\", \"linear\", etc.\n * - Cubic bezier arrays: [0.25, 0.46, 0.45, 0.94]\n * - Step functions and other Motion easing types\n * - Cubic bezier strings: \"cubic-bezier(0.25, 0.46, 0.45, 0.94)\"\n *\n * @param name - The name to register the easing under\n * @param definition - The easing definition (Motion-compatible or cubic-bezier string)\n *\n * @example\n * ```typescript\n * // Register a cubic bezier array\n * registerEasing(\"bouncy\", [0.68, -0.55, 0.265, 1.55]);\n *\n * // Register a cubic-bezier string (will be parsed for motion)\n * registerEasing(\"custom\", \"cubic-bezier(0.25, 0.46, 0.45, 0.94)\");\n * ```\n */\nexport function registerEasing(name: string, definition: EasingDefinition | string): void {\n  if (!name || name.trim() === \"\") throw new Error(\"Custom easing name must be non-empty\");\n\n  // If definition is a string, try to resolve it using existing parsing logic\n  if (typeof definition === \"string\") {\n    const resolved = resolveEasing(definition);\n    if (resolved === null) {\n      throw new Error(`Invalid easing definition: \"${definition}\"`);\n    }\n    customEasings[name] = resolved;\n  } else {\n    // Direct Motion easing definition (array, function, etc.)\n    customEasings[name] = definition;\n  }\n}\n\nexport default {\n  registerEasing,\n  resolveEasing,\n};\n","import { DATA_PREFIX, DEFAULT_OPTIONS } from \"./constants.js\";\nimport type { ElementOptions, PartialMosOptions } from \"./types.js\";\n\n/** Read a numeric attribute in pixels/ms etc. */\nfunction readNumber(el: HTMLElement, name: string): number | undefined {\n  const raw = el.dataset[name as keyof typeof el.dataset];\n  if (raw == null) return undefined;\n  const val = parseFloat(raw);\n  return Number.isFinite(val) ? val : undefined;\n}\n\nexport function resolveElementOptions(el: HTMLElement, global: PartialMosOptions): ElementOptions {\n  const keyframes = el.dataset[DATA_PREFIX as any] || \"fade\";\n\n  const opts: Partial<ElementOptions> = {\n    offset: readNumber(el, `${DATA_PREFIX}Offset`),\n    duration: readNumber(el, `${DATA_PREFIX}Duration`),\n    delay: readNumber(el, `${DATA_PREFIX}Delay`),\n    distance: readNumber(el, `${DATA_PREFIX}Distance`),\n    easing: el.dataset[`${DATA_PREFIX}Easing` as any],\n    anchor: el.dataset[`${DATA_PREFIX}Anchor` as any],\n    once: el.hasAttribute(`data-${DATA_PREFIX}-once`)\n      ? el.getAttribute(`data-${DATA_PREFIX}-once`) !== \"false\"\n      : undefined,\n    mirror: el.hasAttribute(`data-${DATA_PREFIX}-mirror`)\n      ? el.getAttribute(`data-${DATA_PREFIX}-mirror`) !== \"false\"\n      : undefined,\n    anchorPlacement: el.dataset[`${DATA_PREFIX}AnchorPlacement` as any] as any,\n  };\n\n  const merged = { ...DEFAULT_OPTIONS, ...global, ...cleanUndefined(opts) } as ElementOptions;\n\n  return { ...merged, keyframes };\n}\n\nfunction cleanUndefined<T extends Record<string, any>>(obj: T): Partial<T> {\n  const result: Partial<T> = {};\n  for (const k in obj) {\n    if (obj[k] !== undefined) result[k] = obj[k];\n  }\n  return result;\n}\n\nexport default {\n  resolveElementOptions,\n};\n","/**\n * Position calculation utilities based on AOS approach\n * Calculates element trigger positions based on natural document position\n */\n\nimport type { ElementOptions } from \"./types.js\";\n\n/**\n * Get element's natural offset position (ignoring transforms)\n * Based on AOS offset calculation\n */\nexport function getElementOffset(el: HTMLElement): { top: number; left: number } {\n  let x = 0;\n  let y = 0;\n  let element = el;\n\n  while (element && !isNaN(element.offsetLeft) && !isNaN(element.offsetTop)) {\n    x += element.offsetLeft - (element.tagName !== \"BODY\" ? element.scrollLeft : 0);\n    y += element.offsetTop - (element.tagName !== \"BODY\" ? element.scrollTop : 0);\n    element = element.offsetParent as HTMLElement;\n  }\n\n  return {\n    top: y,\n    left: x,\n  };\n}\n\n/**\n * Calculate trigger position for element entering viewport\n */\nexport function getPositionIn(el: HTMLElement, opts: ElementOptions): number {\n  const windowHeight = window.innerHeight;\n  const triggerEl = opts.anchor ? (document.querySelector<HTMLElement>(opts.anchor) ?? el) : el;\n\n  let triggerPoint = getElementOffset(triggerEl).top - windowHeight;\n\n  // Handle anchor placement (9-grid system)\n  switch (opts.anchorPlacement) {\n    case \"top-bottom\":\n      // Default - no adjustment needed\n      break;\n    case \"center-bottom\":\n      triggerPoint += triggerEl.offsetHeight / 2;\n      break;\n    case \"bottom-bottom\":\n      triggerPoint += triggerEl.offsetHeight;\n      break;\n    case \"top-center\":\n      triggerPoint += windowHeight / 2;\n      break;\n    case \"center-center\":\n      triggerPoint += windowHeight / 2 + triggerEl.offsetHeight / 2;\n      break;\n    case \"bottom-center\":\n      triggerPoint += windowHeight / 2 + triggerEl.offsetHeight;\n      break;\n    case \"top-top\":\n      triggerPoint += windowHeight;\n      break;\n    case \"bottom-top\":\n      triggerPoint += windowHeight + triggerEl.offsetHeight;\n      break;\n    case \"center-top\":\n      triggerPoint += windowHeight + triggerEl.offsetHeight / 2;\n      break;\n  }\n\n  return triggerPoint + opts.offset;\n}\n\n/**\n * Calculate trigger position for element exiting viewport (for scroll up behavior)\n */\nexport function getPositionOut(el: HTMLElement, opts: ElementOptions): number {\n  const triggerEl = opts.anchor ? (document.querySelector<HTMLElement>(opts.anchor) ?? el) : el;\n  const elementOffsetTop = getElementOffset(triggerEl).top;\n\n  return elementOffsetTop + triggerEl.offsetHeight - opts.offset;\n}\n\n/**\n * Check if element is above current viewport (for initial state setting)\n */\nexport function isElementAboveViewport(el: HTMLElement): boolean {\n  const elementOffset = getElementOffset(el);\n  const elementBottom = elementOffset.top + el.offsetHeight;\n  return elementBottom < window.scrollY;\n}\n\nexport default {\n  getElementOffset,\n  getPositionIn,\n  getPositionOut,\n  isElementAboveViewport,\n};\n","// ===================================================================\n// UNIFIED ELEMENT MANAGEMENT\n// ===================================================================\n// This module provides a single source of truth for all MOS elements,\n// based on the AOS prepare() pattern.\n\nimport { resolveElementOptions } from \"./attributes.js\";\nimport { getPositionIn, getPositionOut } from \"./position-calculator.js\";\nimport type { MosElement, MosOptions } from \"./types.js\";\n\n// ===================================================================\n// UNIFIED ELEMENT STORAGE (SINGLE SOURCE OF TRUTH)\n// ===================================================================\n\n/**\n * Single source of truth for all elements being tracked by MOS\n * Contains both raw elements and their prepared data (positions, options, state)\n */\nlet mosElements: MosElement[] = [];\n\n// ===================================================================\n// DOM ELEMENT DISCOVERY\n// ===================================================================\n\n/**\n * Gets all raw DOM elements, using prepared elements as cache when available\n * If elements haven't been prepared yet or need refresh, queries DOM directly\n */\nexport function getMosElements(findNewElements: boolean = false): HTMLElement[] {\n  // If we have prepared elements and don't need refresh, extract from them\n  if (!findNewElements && mosElements.length > 0) {\n    return mosElements.map((mosEl) => mosEl.element);\n  }\n\n  // Otherwise, query DOM directly\n  return Array.from(document.querySelectorAll<HTMLElement>(\"[data-mos]\"));\n}\n\n// ===================================================================\n// ELEMENT PREPARATION (AOS-STYLE)\n// ===================================================================\n\n/**\n * Prepares all MOS elements for animation tracking (AOS-style prepare function)\n * Finds elements, calculates positions, sets initial states, and stores everything\n * in a unified array\n */\nexport function prepareElements(elements: HTMLElement[], options: MosOptions): MosElement[] {\n  // Clear previous prepared elements\n  mosElements = [];\n\n  // Prepare each element\n  elements.forEach((element) => {\n    const mosElement = prepareElement(element, options);\n    if (mosElement) {\n      mosElements.push(mosElement);\n    }\n  });\n\n  return mosElements;\n}\n\n/**\n * Prepares a single element for MOS tracking\n * Calculates positions, resolves options, and creates MosElement object\n */\nexport function prepareElement(element: HTMLElement, options: MosOptions): MosElement | null {\n  const animationName = element.getAttribute(\"data-mos\");\n  if (!animationName) return null;\n\n  // Resolve element-specific options using existing attributes system\n  const elementOptions = resolveElementOptions(element, options);\n\n  // Calculate scroll trigger positions\n  const position = {\n    in: getPositionIn(element, elementOptions),\n    out:\n      elementOptions.mirror && !elementOptions.once\n        ? getPositionOut(element, elementOptions)\n        : (false as const),\n  };\n\n  // Create unified MOS element object\n  const mosElement: MosElement = {\n    element,\n    options: elementOptions,\n    position,\n    animated: false,\n    isReversing: false,\n    controls: undefined,\n  };\n\n  return mosElement;\n}\n\n// ===================================================================\n// ELEMENT ACCESS AND MANAGEMENT\n// ===================================================================\n\n/**\n * Gets all prepared elements\n */\nexport function getPreparedElements(): MosElement[] {\n  return mosElements;\n}\n\n/**\n * Finds a prepared element by its DOM element\n */\nexport function findPreparedElement(element: HTMLElement): MosElement | undefined {\n  return mosElements.find((mosEl) => mosEl.element === element);\n}\n\n/**\n * Updates the prepared elements array (for position recalculation)\n */\nexport function updatePreparedElements(elements: MosElement[]): void {\n  mosElements = elements;\n}\n\n/**\n * Clears all prepared elements\n */\nexport function clearAllElements(): void {\n  mosElements = [];\n}\n\nexport default {\n  clearAllElements,\n  findPreparedElement,\n  getMosElements,\n  getPreparedElements,\n  prepareElement,\n  prepareElements,\n  updatePreparedElements,\n};\n","import type { DOMKeyframesDefinition } from \"motion\";\n\nimport { KEYFRAMES_PRESETS } from \"./constants.js\";\nimport type { ElementOptions } from \"./types.js\";\n\n// ------------------- Custom preset registry -------------------\nconst customKeyframes: Record<string, DOMKeyframesDefinition> = {};\n\n/**\n * Register custom animation keyframes by name.\n * Must be called **before** `MOS.init()` so the name can be picked up when elements are observed.\n * Supplying the same name twice will overwrite the previous definition.\n */\nexport function registerKeyframes(name: string, definition: DOMKeyframesDefinition): void {\n  if (!name || name.trim() === \"\") throw new Error(\"Custom keyframes name must be non-empty\");\n  customKeyframes[name] = definition;\n}\n\n/**\n * Resolve a preset first from user-registered presets, then fall back to built-ins.\n */\nexport function resolveKeyframes(name: string): DOMKeyframesDefinition {\n  return (\n    customKeyframes[name] ??\n    KEYFRAMES_PRESETS[name] ??\n    (KEYFRAMES_PRESETS.fade as DOMKeyframesDefinition)\n  );\n}\n\n/**\n * Get keyframes with custom distance applied\n */\nexport function getKeyframesWithDistance(opts: ElementOptions, resolvedKeyframes: any): any {\n  let keyframes = resolvedKeyframes;\n\n  switch (opts.keyframes) {\n    case \"fade-up\":\n      keyframes = { opacity: [0, 1], translateY: [opts.distance, 0] };\n      break;\n    case \"fade-down\":\n      keyframes = { opacity: [0, 1], translateY: [-opts.distance, 0] };\n      break;\n    case \"fade-left\":\n      keyframes = { opacity: [0, 1], translateX: [opts.distance, 0] };\n      break;\n    case \"fade-right\":\n      keyframes = { opacity: [0, 1], translateX: [-opts.distance, 0] };\n      break;\n    // diagonal fades\n    case \"fade-up-right\":\n      keyframes = {\n        opacity: [0, 1],\n        translateY: [opts.distance, 0],\n        translateX: [-opts.distance, 0],\n      };\n      break;\n    case \"fade-up-left\":\n      keyframes = {\n        opacity: [0, 1],\n        translateY: [opts.distance, 0],\n        translateX: [opts.distance, 0],\n      };\n      break;\n    case \"fade-down-right\":\n      keyframes = {\n        opacity: [0, 1],\n        translateY: [-opts.distance, 0],\n        translateX: [-opts.distance, 0],\n      };\n      break;\n    case \"fade-down-left\":\n      keyframes = {\n        opacity: [0, 1],\n        translateY: [-opts.distance, 0],\n        translateX: [opts.distance, 0],\n      };\n      break;\n    // slides\n    case \"slide-up\":\n      keyframes = { translateY: [opts.distance, 0] };\n      break;\n    case \"slide-down\":\n      keyframes = { translateY: [-opts.distance, 0] };\n      break;\n    case \"slide-left\":\n      keyframes = { translateX: [opts.distance, 0] };\n      break;\n    case \"slide-right\":\n      keyframes = { translateX: [-opts.distance, 0] };\n      break;\n    // zoom directional\n    case \"zoom-in-up\":\n    case \"zoom-out-up\":\n      keyframes = { ...resolvedKeyframes, translateY: [opts.distance, 0] };\n      break;\n    case \"zoom-in-down\":\n    case \"zoom-out-down\":\n      keyframes = { ...resolvedKeyframes, translateY: [-opts.distance, 0] };\n      break;\n    case \"zoom-in-left\":\n    case \"zoom-out-left\":\n      keyframes = { ...resolvedKeyframes, translateX: [opts.distance, 0] };\n      break;\n    case \"zoom-in-right\":\n    case \"zoom-out-right\":\n      keyframes = { ...resolvedKeyframes, translateX: [-opts.distance, 0] };\n      break;\n  }\n\n  return keyframes;\n}\n\nexport default {\n  getKeyframesWithDistance,\n  registerKeyframes,\n  resolveKeyframes,\n};\n","import { refreshHard } from \"../index.js\";\n\n/**\n * DOM mutation observer for detecting new elements added to the page\n */\nlet domObserver: MutationObserver | null = null;\n\n/**\n * Check if any nodes in the provided list contain data-mos attributes\n * Recursively checks children as well\n */\nfunction containsMosNode(nodes: NodeList | HTMLElement[]): boolean {\n  for (let i = 0; i < nodes.length; i++) {\n    const currentNode = nodes[i] as HTMLElement;\n\n    // Skip non-element nodes (text nodes, comments, etc.)\n    if (currentNode.nodeType !== Node.ELEMENT_NODE) {\n      continue;\n    }\n\n    // Check if current node has data-mos attribute\n    if (currentNode.dataset && currentNode.dataset.mos) {\n      return true;\n    }\n\n    // Recursively check children\n    if (currentNode.children && currentNode.children.length > 0) {\n      const childrenArray = Array.from(currentNode.children) as HTMLElement[];\n      if (containsMosNode(childrenArray)) {\n        return true;\n      }\n    }\n  }\n\n  return false;\n}\n\n/**\n * Handle mutation observer changes - only trigger refresh if data-mos elements are affected\n */\nfunction handleMutationObserverChanges(mutations: MutationRecord[]): void {\n  if (!mutations || mutations.length === 0) {\n    return;\n  }\n\n  let shouldRefresh = false;\n\n  for (const mutation of mutations) {\n    const addedNodes = Array.from(mutation.addedNodes) as HTMLElement[];\n    const removedNodes = Array.from(mutation.removedNodes) as HTMLElement[];\n    const allNodes = [...addedNodes, ...removedNodes];\n\n    // Check if any added or removed nodes contain data-mos elements\n    if (containsMosNode(allNodes)) {\n      shouldRefresh = true;\n      break;\n    }\n  }\n\n  // Only trigger expensive refresh when data-mos elements are actually affected\n  if (shouldRefresh) {\n    refreshHard();\n  }\n}\n\n/**\n * Start DOM mutation observer to watch for data-mos elements being added/removed\n * Uses AOS-like targeted observation to avoid unnecessary refreshes\n */\nexport function startDomObserver(): void {\n  // Clean up existing observer\n  domObserver?.disconnect();\n\n  // Create new observer with targeted mutation handling\n  domObserver = new MutationObserver(handleMutationObserverChanges);\n\n  // Observe document.documentElement (like AOS) for better performance than document.body\n  domObserver.observe(document.documentElement, {\n    childList: true,\n    subtree: true,\n  });\n}\n\nexport default {\n  startDomObserver,\n};\n","/**\n * Helper utilities for MOS library.\n */\n\nimport type { DeviceDisable } from \"./types.js\";\n\n/**\n * Simple throttle function (no external dependencies)\n * Ensures function is called at most once per delay period\n */\nexport function throttle<T extends (...args: any[]) => void>(\n  func: T,\n  delay: number,\n): (...args: Parameters<T>) => void {\n  let timeoutId: number | null = null;\n  let lastExecTime = 0;\n\n  return (...args: Parameters<T>) => {\n    const currentTime = Date.now();\n\n    if (currentTime - lastExecTime > delay) {\n      func(...args);\n      lastExecTime = currentTime;\n    } else {\n      if (timeoutId) {\n        clearTimeout(timeoutId);\n      }\n      timeoutId = window.setTimeout(\n        () => {\n          func(...args);\n          lastExecTime = Date.now();\n          timeoutId = null;\n        },\n        delay - (currentTime - lastExecTime),\n      );\n    }\n  };\n}\n\n/**\n * Simple debounce function (no external dependencies)\n * Ensures function is called only after delay period of inactivity\n */\nexport function debounce<T extends (...args: any[]) => void>(\n  func: T,\n  delay: number,\n): (...args: Parameters<T>) => void {\n  let timeoutId: number | null = null;\n\n  return (...args: Parameters<T>) => {\n    if (timeoutId) {\n      clearTimeout(timeoutId);\n    }\n    timeoutId = window.setTimeout(() => func(...args), delay);\n  };\n}\n\n/**\n * Evaluate whether MOS should be disabled for current environment.\n * Mirrors AOS `disable` option behaviour.\n */\n/**\n * Determine if MOS should be disabled for the current viewport.\n */\nexport function isDisabled(disable: DeviceDisable): boolean {\n  if (typeof disable === \"boolean\") return disable;\n  if (typeof disable === \"function\") {\n    try {\n      return !!disable();\n    } catch {\n      return false;\n    }\n  }\n  if (typeof window === \"undefined\") return false;\n  const width = window.innerWidth;\n  switch (disable) {\n    case \"phone\":\n      return width < 768;\n    case \"tablet\":\n      return width >= 768 && width < 1024;\n    case \"mobile\":\n      return width < 1024;\n    default:\n      return false;\n  }\n}\n\n/**\n * Remove all `data-mos*` attributes from the given element, used when MOS is\n * globally disabled so that any CSS rules tied to these attributes stop\n * applying.\n */\nexport function removeMosAttributes(el: Element): void {\n  for (const { name } of Array.from(el.attributes)) {\n    if (name.startsWith(\"data-mos\")) {\n      el.removeAttribute(name);\n    }\n  }\n}\n\nexport default {\n  debounce,\n  isDisabled,\n  removeMosAttributes,\n  throttle,\n};\n","// ===================================================================\n// SCROLL-BASED ANIMATION HANDLER\n// ===================================================================\n// This module handles scroll-based animation triggering using a custom\n// AOS-style approach. It replaces Motion's inView with direct scroll\n// event handling for better control over animation timing and state.\n\nimport { play, reverse, setFinalState, setInitialState } from \"./animations.js\";\nimport { DEFAULT_OPTIONS } from \"./constants.js\";\nimport { getPreparedElements } from \"./elements.js\";\nimport { getPositionIn, getPositionOut, isElementAboveViewport } from \"./position-calculator.js\";\nimport type { MosElement } from \"./types.js\";\nimport { throttle } from \"./utils.js\";\n\n// ===================================================================\n// MODULE STATE\n// ===================================================================\n\n/**\n * Reference to the active scroll event handler (for cleanup)\n */\nlet activeScrollHandler: ((...args: any[]) => void) | null = null;\n\n/**\n * Current throttle delay for scroll events (configurable)\n */\nlet currentThrottleDelay = DEFAULT_OPTIONS.throttleDelay;\n\n// ===================================================================\n// ANIMATION STATE MANAGEMENT\n// ===================================================================\n\n/**\n * Determines and applies the correct animation state based on scroll position\n * Uses AOS-like logic with support for mirror functionality\n * @param elementData - The element data containing state and configuration\n * @param scrollY - Current vertical scroll position\n */\nfunction updateElementAnimationState(elementData: MosElement, scrollY: number): void {\n  const { options, position } = elementData;\n\n  /**\n   * Hides the element by reversing its animation\n   * Only triggers if element is currently animated and not already reversing\n   */\n  const hideElement = (): void => {\n    if (!elementData.animated || elementData.isReversing) return;\n\n    // Start reverse animation\n    reverse(elementData);\n  };\n\n  /**\n   * Shows the element by playing its animation\n   * Only triggers if element is not already animated or is currently reversing\n   */\n  const showElement = (): void => {\n    if (elementData.animated && !elementData.isReversing) return;\n\n    // Start forward animation\n    play(elementData);\n  };\n\n  if (\n    options.mirror &&\n    position.out !== undefined &&\n    position.out !== false &&\n    scrollY >= position.out &&\n    !options.once\n  ) {\n    hideElement();\n  } else if (position.in !== undefined && scrollY >= position.in) {\n    showElement();\n  } else if (elementData.animated && !options.once) {\n    hideElement();\n  }\n}\n\n// ===================================================================\n// SCROLL EVENT HANDLING\n// ===================================================================\n\n/**\n * Main scroll event handler that processes all tracked elements\n * Called on every scroll event (throttled for performance)\n */\nfunction processScrollEvent(): void {\n  const currentScrollY = window.scrollY;\n\n  // Update animation state for all prepared elements\n  getPreparedElements().forEach((elementData) => {\n    updateElementAnimationState(elementData, currentScrollY);\n  });\n}\n\n// ===================================================================\n// ELEMENT PREPARATION AND POSITIONING\n// ===================================================================\n\n/**\n * Calculates the scroll positions that will trigger animations for an element\n * @param elementData - The element data to calculate positions for\n */\nfunction calculateElementTriggerPositions(elementData: MosElement): void {\n  const { element, options } = elementData;\n\n  elementData.position = {\n    // Calculate entry position (when element should animate in)\n    in: getPositionIn(element, options),\n    // Calculate exit position (when element should animate out) - only if mirror is enabled\n    out: options.mirror && !options.once ? getPositionOut(element, options) : false,\n  };\n}\n\n/**\n * Sets the initial animation state for an element based on its viewport position\n * @param elementData - The element data to set initial state for\n */\nfunction setElementInitialState(elementData: MosElement): void {\n  const { element, options } = elementData;\n\n  if (isElementAboveViewport(element) && !options.mirror) {\n    // Element is above viewport - set to final animated state immediately\n    setFinalState(elementData);\n  } else {\n    // Element is in or below viewport - set to initial state\n    setInitialState(elementData);\n  }\n}\n\n/**\n * Refreshes all tracked elements by recalculating positions and states\n * Called when the library needs to update after configuration changes\n * Preserves current animation states to prevent flicker during resize\n */\nexport function evaluateElementPositions(): void {\n  getPreparedElements().forEach((elementData) => {\n    calculateElementTriggerPositions(elementData);\n\n    // Only reset initial state for elements that haven't been animated yet\n    // This prevents flicker during resize for already-animated elements\n    if (!elementData.animated) {\n      setElementInitialState(elementData);\n    }\n  });\n\n  // Process current scroll position to animate elements already in viewport\n  processScrollEvent();\n}\n\n// ===================================================================\n// CONFIGURATION MANAGEMENT\n// ===================================================================\n\n/**\n * Updates the throttle delay used by the scroll handler\n * Called from the main initialization to apply user configuration\n * @param throttleDelay - Delay in ms for throttling scroll events\n */\nexport function updateScrollHandlerDelays(throttleDelay: number): void {\n  currentThrottleDelay = throttleDelay;\n}\n\n// ===================================================================\n// SCROLL HANDLER LIFECYCLE\n// ===================================================================\n\n/**\n * Initializes the scroll event handler system with throttling\n * Sets up listener for scroll events only (layout changes handled in index.ts)\n */\nexport function ensureScrollHandlerActive(): void {\n  // Prevent multiple initializations\n  if (activeScrollHandler) return;\n\n  // Create throttled scroll handler for performance\n  const throttledScrollHandler = throttle(processScrollEvent, currentThrottleDelay);\n\n  // Set up scroll event listener\n  window.addEventListener(\"scroll\", throttledScrollHandler, { passive: true });\n\n  // Store reference for cleanup\n  activeScrollHandler = throttledScrollHandler;\n}\n\n/**\n * Cleans up the scroll handler system and removes all event listeners\n * Resets all tracking state to initial conditions\n */\nexport function cleanupScrollHandler(): void {\n  if (activeScrollHandler) {\n    // Remove scroll event listener\n    window.removeEventListener(\"scroll\", activeScrollHandler);\n\n    // Clear handler reference\n    activeScrollHandler = null;\n  }\n}\n\nexport default {\n  cleanupScrollHandler,\n  ensureScrollHandlerActive,\n  evaluateElementPositions,\n  updateScrollHandlerDelays,\n};\n","// ===================================================================\n// MOTION-ON-SCROLL (MOS) - Main Entry Point\n// ===================================================================\n// This file provides the public API for the Motion-on-Scroll library.\n// It handles initialization, configuration, and lifecycle management.\n\nimport { registerAnimation } from \"./helpers/animations.js\";\nimport { DEFAULT_OPTIONS } from \"./helpers/constants.js\";\nimport { registerEasing } from \"./helpers/easing.js\";\nimport { clearAllElements, getMosElements, prepareElements } from \"./helpers/elements.js\";\nimport { registerKeyframes } from \"./helpers/keyframes.js\";\nimport { startDomObserver } from \"./helpers/observer.js\";\nimport {\n  cleanupScrollHandler,\n  ensureScrollHandlerActive,\n  evaluateElementPositions,\n  updateScrollHandlerDelays,\n} from \"./helpers/scroll-handler.js\";\nimport type { MosOptions, PartialMosOptions } from \"./helpers/types.js\";\nimport { debounce, isDisabled, removeMosAttributes } from \"./helpers/utils.js\";\n\n// ===================================================================\n// LIBRARY STATE MANAGEMENT\n// ===================================================================\n\n/**\n * Global configuration options merged from all init() calls\n */\nlet libraryConfig: MosOptions = DEFAULT_OPTIONS;\n\n/**\n * Tracks whether the library has been initialized and is actively running\n */\nlet isLibraryActive = false;\n\n// ===================================================================\n// CONFIGURATION AND TIME UNITS\n// ===================================================================\n\n/**\n * Adjusts duration and delay values when using seconds instead of milliseconds\n * Only applied on first initialization when timeUnits is set to \"s\"\n * @param config - The configuration object to potentially modify\n */\nfunction adjustTimeUnitsOnFirstInit(config: MosOptions, newOptions: PartialMosOptions): void {\n  if (isLibraryActive || config.timeUnits !== \"s\") return;\n\n  // Convert default duration from ms to seconds if not explicitly set\n  if (newOptions.duration == null) {\n    config.duration = DEFAULT_OPTIONS.duration / 1000;\n  }\n\n  // Convert default delay from ms to seconds if not explicitly set\n  if (newOptions.delay == null) {\n    config.delay = DEFAULT_OPTIONS.delay / 1000;\n  }\n}\n\n/**\n * Recalculates element positions after layout changes\n * Called on window resize and orientation change\n */\nexport function handleLayoutChange(): void {\n  if (isLibraryActive) {\n    evaluateElementPositions();\n  }\n}\n\n/**\n * Sets up event listeners for layout changes (resize, orientation)\n * Uses debounced handlers to prevent excessive recalculations\n */\nfunction setupLayoutChangeListeners(): void {\n  const debounceDelay = libraryConfig.debounceDelay;\n  const debouncedHandler = debounce(handleLayoutChange, debounceDelay);\n\n  window.addEventListener(\"resize\", debouncedHandler);\n  window.addEventListener(\"orientationchange\", debouncedHandler);\n}\n\n/**\n * Sets up the start event listener based on configuration\n * Handles both standard events (DOMContentLoaded, load) and custom events\n */\nexport function setupStartEventListener(): void {\n  const startEvent = libraryConfig.startEvent;\n\n  // If the desired event has already fired, bootstrap immediately\n  if (\n    (startEvent === \"DOMContentLoaded\" &&\n      [\"interactive\", \"complete\"].includes(document.readyState)) ||\n    (startEvent === \"load\" && document.readyState === \"complete\")\n  ) {\n    refresh(true);\n    return;\n  } else if (startEvent === \"load\") {\n    // Otherwise, attach listener for the start event\n    window.addEventListener(startEvent, () => refresh(true), { once: true });\n  } else {\n    document.addEventListener(startEvent, () => refresh(true), { once: true });\n  }\n}\n\n// ===================================================================\n// PUBLIC API\n// ===================================================================\n\n/**\n * Initializes the Motion-on-Scroll library with the given options\n * Can be called multiple times - options will be merged\n * @param options - Configuration options for the library\n * @returns Array of elements found in the DOM (for compatibility)\n */\nfunction init(options: PartialMosOptions = {}): HTMLElement[] {\n  // Merge new options with existing configuration\n  libraryConfig = { ...DEFAULT_OPTIONS, ...options };\n\n  // Handle time unit conversion on first initialization\n  adjustTimeUnitsOnFirstInit(libraryConfig, options);\n\n  // If already initialized, just refresh with new options\n  if (isLibraryActive) {\n    refresh();\n    return getMosElements(); // Return current DOM elements\n  }\n\n  // First time init - find elements and check for global disable\n  const foundElements = getMosElements();\n\n  // Handle global disable - clean up and exit early\n  if (isDisabled(libraryConfig.disable)) {\n    foundElements.forEach(removeMosAttributes);\n    return [];\n  }\n\n  // Set up event listeners\n  setupStartEventListener();\n  setupLayoutChangeListeners();\n\n  // Don't start mutation observer if disabled or not supported\n  if (!libraryConfig.disableMutationObserver && typeof MutationObserver !== \"undefined\") {\n    startDomObserver();\n  }\n\n  // Return current elements\n  return foundElements;\n}\n\n/**\n * Refreshes the library by updating element positions and re-initializing scroll system\n * Does NOT re-find elements - only updates existing tracked elements\n * @param shouldActivate - Whether this refresh should activate the library (if not already active)\n */\nfunction refresh(shouldActivate = false): void {\n  if (shouldActivate) isLibraryActive = true;\n  if (isLibraryActive) {\n    // Configure performance settings from library config\n    updateScrollHandlerDelays(libraryConfig.throttleDelay);\n\n    const foundElements = getMosElements();\n\n    // Use unified element system to prepare elements (reusing previously found elements)\n    prepareElements(foundElements, libraryConfig);\n\n    // Ensure scroll handler is active to process all prepared elements\n    ensureScrollHandlerActive();\n\n    // Calculate positions and set initial states for all elements\n    evaluateElementPositions();\n  }\n}\n\n/**\n * Performs a hard refresh - re-finds all MOS elements and completely re-initializes\n * This is a full re-initialization that discovers new elements in the DOM\n */\nfunction refreshHard(): void {\n  // Re-find all MOS elements in case any were added or removed\n  const foundElements = getMosElements(true);\n\n  // Handle global disable - clean up and exit early\n  if (isDisabled(libraryConfig.disable)) {\n    foundElements.forEach(removeMosAttributes);\n    return;\n  }\n\n  // Clear existing prepared elements and clean up scroll handlers\n  clearAllElements();\n  cleanupScrollHandler();\n\n  // re-calculate positions and init scroll system\n  refresh();\n}\n\n// ===================================================================\n// EXPORTS\n// ===================================================================\n\nexport const MOS = {\n  init,\n  refresh,\n  refreshHard,\n  registerKeyframes,\n  registerEasing,\n  registerAnimation,\n};\n\nexport { init, refresh, refreshHard, registerAnimation, registerEasing, registerKeyframes };\n\nexport default MOS;\n"],"mappings":"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","names":["animate","DEFAULT_OPTIONS","EASINGS","KEYFRAMES_PRESETS","customEasings","resolveEasing","input","EASINGS","candidate","cubicMatch","nums","n","arrayMatch","registerEasing","name","definition","resolved","readNumber","el","name","raw","val","resolveElementOptions","global","keyframes","opts","DEFAULT_OPTIONS","cleanUndefined","obj","result","k","getElementOffset","el","x","y","element","getPositionIn","opts","windowHeight","triggerEl","triggerPoint","getPositionOut","isElementAboveViewport","mosElements","getMosElements","findNewElements","mosEl","prepareElements","elements","options","element","mosElement","prepareElement","elementOptions","resolveElementOptions","position","getPositionIn","getPositionOut","getPreparedElements","findPreparedElement","clearAllElements","mosElements","customKeyframes","registerKeyframes","name","definition","resolveKeyframes","KEYFRAMES_PRESETS","getKeyframesWithDistance","opts","resolvedKeyframes","keyframes","activeAnimations","customAnimationRegistry","registerAnimation","name","factory","ensureAnimationControls","element","options","mosElement","findPreparedElement","controls","createAnimationControls","setInitialState","setupAnimationCompletionHandler","handleReverseAnimationCompletion","handleForwardAnimationCompletion","handleAnimationInterruption","customAnimation","createCustomAnimation","createKeyframeAnimation","keyframes","resolveAnimationKeyframes","easing","resolveAnimationEasing","animate","resolvedKeyframes","resolveKeyframes","DEFAULT_OPTIONS","getKeyframesWithDistance","resolveEasing","setFinalState","play","reverse","domObserver","containsMosNode","nodes","i","currentNode","childrenArray","handleMutationObserverChanges","mutations","shouldRefresh","mutation","addedNodes","removedNodes","allNodes","refreshHard","startDomObserver","throttle","func","delay","timeoutId","lastExecTime","args","currentTime","debounce","isDisabled","disable","width","removeMosAttributes","el","name","activeScrollHandler","currentThrottleDelay","DEFAULT_OPTIONS","updateElementAnimationState","elementData","scrollY","options","position","hideElement","reverse","showElement","play","processScrollEvent","currentScrollY","getPreparedElements","calculateElementTriggerPositions","element","getPositionIn","getPositionOut","setElementInitialState","isElementAboveViewport","setFinalState","setInitialState","evaluateElementPositions","updateScrollHandlerDelays","throttleDelay","ensureScrollHandlerActive","throttledScrollHandler","throttle","cleanupScrollHandler","libraryConfig","DEFAULT_OPTIONS","isLibraryActive","adjustTimeUnitsOnFirstInit","config","newOptions","handleLayoutChange","evaluateElementPositions","setupLayoutChangeListeners","debounceDelay","debouncedHandler","debounce","setupStartEventListener","startEvent","refresh","init","options","getMosElements","foundElements","isDisabled","removeMosAttributes","startDomObserver","shouldActivate","updateScrollHandlerDelays","prepareElements","ensureScrollHandlerActive","refreshHard","clearAllElements","cleanupScrollHandler","MOS","registerKeyframes","registerEasing","registerAnimation","index_default","MOS"]}